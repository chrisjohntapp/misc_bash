_lib_pingable=1

check_pingable()
{
  # Check if a FQDN can be pinged.
  # You can allow for occasional dropped packets by adjusting the number of pings
  # to use in the test (using the -p flag). Only if all pings fail will the fqdn
  # be classed as down. 
  
  num_pings=3
  OPTIND=1

  while getopts 'p:' opt; do
    case "$opt" in
      p) num_pings="$OPTARG" ;;
      *) printf "Usage: check_alive [ -p <number of pings> ] fqdn\n  (-p The number of pings to use (default is 3)).\n"
         return 1 ;;
    esac
  done

  # Remove any processed options from argv.
  for i in $(seq 2 $OPTIND); do
    shift
  done

  # Assign remaining argument to variable.
  fqdn=$1
  if [ -z "$fqdn" ]; then
    printf "No fqdn supplied.\n"
    return 1
  fi
 
  # Check if fqdn is resolvable.
  if [ -z "$(dig $fqdn a +short)" ]; then
    printf "Cannot resolve that fqdn.\n"
    return 1
  fi

  # Ping the target fqdn.
  for i in $(seq $num_pings); do
    results[$i]=$(ping -c 1 $fqdn >/dev/null; printf "$?\n")
    sleep 1
  done

  # If there are no successful pings, check failed.
  if [[ ! $(printf "%s" ${results[@]} | grep 0) ]]; then
    printf "$fqdn is not pingable.\n"
    return 1
  fi
}

# vi:syntax=sh
# EOF
